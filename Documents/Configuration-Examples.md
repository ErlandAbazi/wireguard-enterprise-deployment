# Configuration Examples

This document contains ready-to-use configuration commands for:

- MikroTik RouterOS
- Windows Server
- Windows clients
- Mobile clients
- Linux&MacOS client

## MikroTik Router (WireGuard Server)

First, we create the virtual interface:
```
interface/wireguard/add name="VIRTUAL_INTERFACE_NAME" listen-port="LISTEN_PORT" private-key="SERVER_PRIVATE_KEY"
```
Next, we'll assign this virtual interface an IP:
```
ip/address/add address="VIRTUAL_INTERFACE_IP" interface="VIRTUAL_INTERFACE_NAME"
```
Now we need to forward traffic arriving to the router towards this virtual interface:
```
ip/firewall/nat/add chain=dstnat dst-address="YOUR_PUBLIC_IP" protocol=udp dst-port="LISTEN_PORT" action=dst-nat to-addresses="VIRTUAL_INTERFACE_IP" to-ports="LISTEN_PORT"
```
In case your router has a default blocklist you will need a new rule to allow traffic to come in:
```
ip/firewall/filter/add chain=input dst-address="YOUR_PUBLIC_IP" protocol=udp dst-port="LISTEN_PORT" action=accept
```
Now you can add your first peer/client:
```
interface/wireguard/peers/add name="PEER_NAME" public-key="PEER_PUBLIC_KEY" allowed-address="PEER_ADDRESS"
```

These are all the variables you will need at minimum to create proper traffic flow for WireGuard server side. 


## Windows Server (Deployment)

I recommend a short powershell command to get the .msi file quickly from WireGuard's website:
```
Invoke-WebRequest -Uri https://download.wireguard.com/windows-client/wireguard-amd64-0.5.3.msi -OutFile .\WireGuard.msi
```
Next, copy this file to your shared network folder of choice. Make sure to review share privileges and double check that domain joined computers will have access to this resource.

Now we will need to deploy this software from Group Policy Management Console:

1. Right click the organizational unit where your computers reside and link a new GPO there. Name it accordingly.
2. Edit this newly created GPO and navigate to:
```
Computer Configuration → Policies → Software Settings → Software Installation
```
 Right click to add a new package and use the network path like so:
```
\\server.ip\share\WireGuard.msi
```
and choose Assign.

The last thing we'll need to do on our server is distribute the registry key for limited UI access and assign the users as a part of Network Configuration Operators.

On the same organizational unit as before:

1. Right click and link a new GPO here. Name it for its purpose.
2. Edit and navigate to:
```
Computer Configuration → Preferences → Windows Settings → Registry
```
and here you want to right click and choose "New Registry Item."
3. Action = Create, Hive = HKEY_LOCAL_MACHINE, Key Path = SOFTWARE\Wireguard, ValueName = LimitedOperatorUI, Value type = REG_DWORD, Value data = 1

Next, we'll assign the setting regarding Network Configuration Operators group.

4. Again, you'll go to:
```
Computer Configuration → Preferences → Control Panel Settings → Local Users and Groups 
```
and right click to create "New Local Group".

5. Action = Update, Group name = Network Configuration Operators(built-in).
6. On the bottom choose "Add" and assign the required user security group.

Now we're done with our server configuration. 


## Windows Client

1. First, log in as a member of the Administrators group.
2. Open Wireguard and on the bottom left either add from a tunnel file or create a new empty tunnel file with YOUR_TUNNEL_NAME.conf
3. The configuration of the file should have a precise name and use the following settings:
```
PublicKey = "PEER_PUBLIC_KEY"
[Interface]
PrivateKey = Generated by the WireGuard app
Address = "PEER_ADDRESS"
DNS = se.rv.er.one, se.rv.er.two (IPv4 addresses) 

[Peer]
PublicKey = Generated by "VIRTUAL_INTERFACE_NAME" on Mikrotik
AllowedIPs = Traffic you wish to route through the VPN tunnel
Endpoint = "YOUR_PUBLIC_IP":"LISTEN_PORT"
```
4. Now that you've created your tunnel file, the remaining bit is this powershell command:
```
Start-Process 'C:\Program Files\WireGuard\wireguard.exe' -ArgumentList '/installtunnelservice', 'YOUR_TUNNEL_NAME.conf' -Wait -NoNewWindow -PassThru | Out-Null
Start-Process sc.exe -ArgumentList 'config', 'WireGuardTunnel$YOUR_TUNNEL_NAME', 'start= auto' -Wait -NoNewWindow -PassThru | Out-Null
Start-Service -Name WireGuardTunnel$YOUR_TUNNEL_NAME -ErrorAction SilentlyContinue
```
this will guarantee that your tunnel is set as a service to automatically start on boot.

## Mobile Devices

1. Install the app from App/Play Store first.
2. Use [wireguardconfig.com](https://www.wireguardconfig.com/qrcode) by using the same logic as point 3 above to generate the QR Code.
3. Save the QR code as an image and send it to your end users to scan. 

## MacOS&Linux 

For MacOS:
1. Get the app from the App Store.
2. Open it and either use a .conf tunnel file generated from the website above, or use an empty configuration file.
3. Same as the Windows Client, input all the arguments for the tunnel.
4. Enable the checkbox:"Activate on Login".

For Linux:
1. The app is built in for most modern distros.
2. You can use the GUI available to create all the arguments as seen above.
3. The tunnel will autostart on login.

This will hopefully cover all your endpoint needs. 
